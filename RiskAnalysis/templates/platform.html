<!DOCTYPE html>
<meta charset="utf-8">

<script src="{{ STATIC_URL }}/static/d3.v3.min.js"></script>
<script src="{{ STATIC_URL }}/static/china-map.js"></script>
<script src="{{ STATIC_URL }}/static/d3.min.js"></script>
<script src="{{ STATIC_URL }}/static/vendor/jquery/jquery.min.js"></script>
<script src="{{ STATIC_URL }}/static/js/liquidFillGauge.js" language="JavaScript"></script>

<script src="{{ STATIC_URL }}/static/bubble_chart/d3-transform.js"></script>
<script src="{{ STATIC_URL }}/static/bubble_chart/extarray.js"></script>
<script src="http://phuonghuynh.github.io/js/bower_components/cafej/src/misc.js"></script>
<script src="http://phuonghuynh.github.io/js/bower_components/cafej/src/micro-observer.js"></script>
<script src="{{ STATIC_URL }}/static/bubble_chart/microplugin.js"></script>
<script src="{{ STATIC_URL }}/static/bubble_chart/bubble-chart.js"></script>
<script src="{{ STATIC_URL }}/static/bubble_chart/central-click.js"></script>
<script src="{{ STATIC_URL }}/static/bubble_chart/lines.js"></script>
<script src="{{ STATIC_URL }}/static/sentiment.js"></script>
<script src="{{ STATIC_URL }}/static/dataTables/jquery.dataTables.min.js"></script>
<script src="{{ STATIC_URL }}/static/dataTables/dataTables.bootstrap.min.js"></script>
<script src="{{ STATIC_URL }}/static/dataTables/dataTables.responsive.js"></script>
<style>
    .row-center {
        text-align: center;
    }

    .link {
        fill: none;
        stroke: #666;
        stroke-width: 1.5px;
    }

    .node circle {
        fill: #ccc;
        stroke: #fff;
        stroke-width: 1.5px;
    }

    .tooltip2 {
        text-decoration: underline;
    }

    .state {
        fill: none;
        stroke: #a9a9a9;
        stroke-width: 1;
    }

    .state:hover {
        fill-opacity: 0.5;
    }

    #tooltip {
        position: absolute;
        text-align: center;
        padding: 20px;
        margin: 10px;
        font: 12px sans-serif;
        background: lightsteelblue;
        border: 1px;
        border-radius: 2px;
        pointer-events: none;
    }

    #tooltip h4 {
        margin: 0;
        font-size: 14px;
    }

    #tooltip {
        background: rgba(0, 0, 0, 0.9);
        border: 1px solid grey;
        border-radius: 5px;
        font-size: 12px;
        width: auto;
        padding: 4px;
        color: white;
        opacity: 0;
    }

    #tooltip table {
        table-layout: fixed;
    }

    #tooltip tr td {
        padding: 0;
        margin: 0;
    }

    #tooltip tr td:nth-child(1) {
        width: 50px;
    }

    #tooltip tr td:nth-child(2) {
        text-align: center;
    }

    .axis text {
        font: 10px sans-serif;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
    }

    .bar {
        fill: #F00000;
        fill-opacity: .9;
    }

    .x.axis path {
        display: none;
    }

    label2 {
        position: absolute;
        top: 10px;
        right: 10px;
    }

    #dynamic svg {
        font-family: "Helvetica Neue", Helvetica;
    }

    #dynamic .line {
        fill: none;
        stroke: #000;
        stroke-width: 2px;
    }
    .btn-danger{
        margin-top: 5px;
    }
</style>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>{{ platform_name }}风险分析</title>

    <!-- Bootstrap core CSS -->
    <link href="{{ STATIC_URL }}/static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="{{ STATIC_URL }}/static/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet"
          type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Cabin:700' rel='stylesheet' type='text/css'>

    <!-- Custom styles for this template -->
    <link href="{{ STATIC_URL }}/static/css/grayscale.min.css" rel="stylesheet">

    <!-- Page level plugin CSS-->
    <link href="{{ STATIC_URL }}/static/vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet">

    <link rel="stylesheet" type="text/css"
          href="https://fonts.googleapis.com/css?family=Open+Sans:400,600">
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}/static/vendor/sequences/sequences.css"/>

    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>

    <link href="{{ STATIC_URL }}/static/css/timeline.css" rel="stylesheet">

    <!-- Morris Charts CSS -->
    <link href="{{ STATIC_URL }}/static/vendor/morrisjs/morris.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="{{ STATIC_URL }}/static/dist/css/sb-admin-2.css" rel="stylesheet">

    <!-- DataTables CSS -->
    <link href="{{ STATIC_URL }}/static/dataTables/dataTables.bootstrap.css" rel="stylesheet">

    <!-- DataTables Responsive CSS -->
    <link href="{{ STATIC_URL }}/static/dataTables/dataTables.responsive.css" rel="stylesheet">

</head>


<body id="page-top">

<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
    <div class="container">
        <a class="navbar-brand js-scroll-trigger" href="#page-top">{{ platform_name }}风险分析</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
                data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
                aria-label="Toggle navigation">
            Menu
            <i class="fa fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link js-scroll-trigger" href="#total">整体分析</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link js-scroll-trigger" href="#judicial">司法</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link js-scroll-trigger" href="#commerce">工商</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link js-scroll-trigger" href="#business">经营</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link js-scroll-trigger" href="#tax">税务</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link js-scroll-trigger" href="#sentiment">舆情</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link js-scroll-trigger" href="#out_line">违规</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link js-scroll-trigger" href="#employee">招聘</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Intro Header -->
<header class="totalhead">
    <div class="intro-body">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <a href="#total" class="btn btn-circle js-scroll-trigger" style="margin-top:210px;color:black">
                        <i class="fa fa-angle-double-down animated"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- About Section -->
<section id="total" class="content-section text-center" style="padding-top:50px;padding-bottom:5px">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <h1>企业整体风险分析</h1>
            </div>
        </div>
    </div>
    <!--<img src="{{ STATIC_URL }}/static/img/platform_0.JPG" alt="整体分析"/>-->
    <div class="row">
        <svg id="fillgauge1" width="20%" height="200"></svg>
        <div id="sorceSort"></div>
        <label><input type="checkbox">排序</label>
        <div id="totalText" style="float:right; width: 42%; padding-top: 10px">
            <h4 style="text-align: right">企业法定代表人：{{ company_info.legal_person }}</h4>
            <h4 style="text-align: right">注册资本：{{ company_info.register_capital }}万元人民币</h4>
            <h4 style="text-align: right">经营状态：{{ company_info.business_state }}</h4>
        </div>
        <script>

            var margin = {top: 0, right: 0, bottom: 20, left: 40},
                width = 500 - margin.left - margin.right,
                height = 200 - margin.top - margin.bottom;

            var sort_x = d3.scale.ordinal()
                .rangeRoundBands([0, width], .1, 1);

            var sort_y = d3.scale.linear()
                .range([height, 0]);

            var xAxis = d3.svg.axis()
                .scale(sort_x)
                .orient("bottom");

            var yAxis = d3.svg.axis()
                .scale(sort_y)
                .orient("left");

            var svg_sort = d3.select("#sorceSort").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", 200)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            d3.tsv("{{ STATIC_URL }}/static/data.tsv", function (error, data) {

                data.forEach(function (d) {
                    d.frequency = +d.frequency;
                });

                sort_x.domain(data.map(function (d) {
                    return d.letter;
                }));
                sort_y.domain([0, d3.max(data, function (d) {
                    return d.frequency;
                })]);

                svg_sort.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + 180 + ")")
                    .call(xAxis);

                svg_sort.append("g")
                    .attr("class", "y axis")
                    .call(yAxis)
                    .append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 6)
                    .attr("dy", ".71em")
                    .style("text-anchor", "end")
                    .text("风险值");

                svg_sort.selectAll(".bar")
                    .data(data)
                    .enter().append("rect")
                    .attr("class", "bar")
                    .attr("x", function (d) {
                        return sort_x(d.letter);
                    })
                    .attr("width", sort_x.rangeBand() * 2 / 3)
                    .attr("y", function (d) {
                        return sort_y(d.frequency);
                    })
                    .attr("height", function (d) {
                        return 180 - sort_y(d.frequency);
                    });

                d3.select("input").on("change", change_sort);

                var sortTimeout = setTimeout(function () {
                    d3.select("input").property("checked", true).each(change_sort);
                }, 2000);

                function change_sort() {
                    clearTimeout(sortTimeout);
                    // Copy-on-write since tweens are evaluated after a delay.
                    var x_sort = sort_x.domain(data.sort(this.checked
                        ? function (a, b) {
                            return b.frequency - a.frequency;
                        }
                        : function (a, b) {
                            return d3.ascending(a.letter, b.letter);
                        })
                        .map(function (d) {
                            return d.letter;
                        }))
                        .copy();

                    svg_sort.selectAll(".bar")
                        .sort(function (a, b) {
                            return x_sort(a.letter) - x_sort(b.letter);
                        });

                    var transition = svg_sort.transition().duration(750),
                        delay = function (d, i) {
                            return i * 50;
                        };

                    transition.selectAll(".bar")
                        .delay(delay)
                        .attr("x", function (d) {
                            return x_sort(d.letter);
                        });

                    transition.select(".x.axis")
                        .call(xAxis)
                        .selectAll("g")
                        .delay(delay);
                }
            });

        </script>
    </div>

    <div id="sequences">
        <div id="main">
            <div id="sequence"></div>
            <div id="chart">
                <div id="explanation" style="visibility: hidden;">
                    <span id="percentage"></span><br/>
                    influence of the overall risk
                </div>
                <div id="explanationPicture">
                    <div class="radarChart"></div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="{{ STATIC_URL }}/static/vendor/sequences/sequences.js"></script>
    <script type="text/javascript">
        // Hack to make this example display correctly in an iframe on bl.ocks.org
        d3.select(self.frameElement).style("height", "700px");
    </script>

    <script src="{{ STATIC_URL }}/static/vendor/sequences/radarChart.js"></script>
    <script>

        /* Radar chart design created by Nadieh Bremer - VisualCinnamon.com */

        var margin = {top: 100, right: 100, bottom: 100, left: 100},
            width = Math.min(700, window.innerWidth - 10) - margin.left - margin.right,
            height = Math.min(width, window.innerHeight - margin.top - margin.bottom - 20);

        var data = [
            [
                {axis: "舆情", value: {{ news_risk_score }} },
                {axis: "经营", value: {{ business_risk_score }} },
                {axis: "工商", value: {{ admin_risk_score }} },
                {axis: "招聘", value: {{ employ_risk_score }} },
                {axis: "税务", value: {{ tax_risk_score }} },
                {axis: "违规", value: {{ outline_risk_score }} },
                {axis: "司法", value: {{ law_risk_score }} },
            ]
        ];

        var color = d3.scale.ordinal()
            .range(["#00A0B0"]);

        var radarChartOptions = {
            w: width,
            h: height,
            margin: margin,
            maxValue: 0.5,
            levels: 5,
            roundStrokes: true,
            color: color
        };
        //Call function to draw the Radar chart
        RadarChart(".radarChart", data, radarChartOptions);
    </script>
    <a href="#judicial" class="btn btn-circle js-scroll-trigger" style="margin-top:120px; color:gray">
        <i class="fa fa-angle-double-down animated"></i>
    </a>

</section>

<section id="judicial" class="content-section text-center" style="padding-top:50px">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <h1>司法信息风险分析</h1>
            </div>
        </div>
    </div>
    <div>
        <h2 style="text-align:left;padding-left: 100px">司法信息</h2>
        <div style="float:left;padding-left: 100px">
            {% for law_type in law_type_info %}
            <button type="button" class="btn btn-danger">{{ law_type.case_brief }} <span class="badge">{{ law_type.case_count }}</span>
            </button>
            {% endfor %}
        </div>
        <svg id="fillgauge2" style="float:right" width="20%" height="200"></svg>
    </div>
    <div id="platform_relation"></div>
    <script>

        $.ajax({method:'get',url:'/businessrelation.json'}).done(function (data){
            linksData = data.link_data;

            var links = linksData;

            var nodes = {};

        // Compute the distinct nodes from the links.
        links.forEach(function (link) {
            link.source = nodes[link.source] || (nodes[link.source] = {
                name: link.source,
                color: link.color,
                value: link.value
            });
            link.target = nodes[link.target] || (nodes[link.target] = {
                name: link.target,
                color: link.color,
                value: link.value
            });
        });

        var width = 1080,
            height = 800;

        var force = d3.layout.force()
            .nodes(d3.values(nodes))
            .links(links)
            .size([width, height])
            .linkDistance(10)
            .charge(-1300)
            .on("tick", tick)
            .start();

        var svg_relation = d3.select("#platform_relation").append("svg")
            .attr("width", width)
            .attr("height", height);

        // Per-type markers, as they don't inherit styles.
        svg_relation.append("defs").selectAll("marker")
            .data(["suit", "licensing", "resolved"])
            .enter().append("marker")
            .attr("id", function (d) {
                return d;
            })
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", 15)
            .attr("refY", -1.5)
            .attr("markerWidth", 16)
            .attr("markerHeight", 16)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M0,-5L10,0L0,5");

        var path = svg_relation.append("g").selectAll("path")
            .data(force.links())
            .enter().append("path")
            .attr("class", function (d) {
                return "link " + d.type;
            })
            .attr("marker-end", function (d) {
                return "url(#" + d.type + ")";
            })
            .style("stroke", function (d) {
                if (d.color == "c6dbef") return ("#3182bd");
                else return ("#fd8d3c");
            })
            .style("fill", "none")
            .style("stroke-width", "1.5px");

        var circle = svg_relation.append("g").selectAll("circle")
            .data(force.nodes())
            .enter().append("circle")
            .attr("r", function (d) {
                return (d.value);
            })
            .style("fill", function (d) {
                return (d.color);
            })
            .style("stroke", function (d) {
                if (d.color == "c6dbef") return ("#3182bd");
                else return ("#fd8d3c");
            })
            .call(force.drag);

        var text = svg_relation.append("g").selectAll("text")
            .data(force.nodes())
            .enter().append("text")
            .style("font-size", function (d) {
                return Math.max((d.value / 2), 10) + "px";
            })
            .style("fill", function (d) {
                if (d.color == "c6dbef") return ("#3382bd");
                else return ("#ff8d3c");
            })
            .attr("x", function (d) {
                return 0 - (d.name).length * (d.value / 4);
            })
            .attr("y", ".31em")
            .text(function (d) {
                return d.name;
            });

        // Use elliptical arc path segments to doubly-encode directionality.
        function tick() {
            path.attr("d", linkArc);
            circle.attr("transform", transform);
            text.attr("transform", transform);
        }

        function linkArc(d) {
            var dx = d.target.x - d.source.x,
                dy = d.target.y - d.source.y,
                dr = Math.sqrt(dx * dx + dy * dy);
            return "M" + d.source.x + "," + d.source.y + "A" + dr + "," + dr + " 0 0,1 " + d.target.x + "," + d.target.y;
        }

        function transform(d) {
            return "translate(" + d.x + "," + d.y + ")";
        }

    }).fail();


    </script>

    <div class="judicialDetail" style="padding-top: 50px">
        <div id="judicialLeft" style="float:left; width:55%">
            <div id="tooltip"></div><!-- div to hold tooltip. -->
            <svg width="100%" height="620" id="statesvg" style="float:left;padding-top: 100px"></svg>

        <div class="col-lg-12" style="float:left">
            <div class="panel panel-default">
                <div class="panel-heading" style="font-size:20px">
                    关键案件
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>企业名称</th>
                                <th>发布时间</th>
                                <th>案件性质</th>
                                <th>案由</th>
                                <th>判决结果</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for list_law_item in list_law_info %}
                            {% if forloop.counter|divisibleby:2 %}
                            <tr class="success">
                                {% else %}
                            <tr class="warning">
                                {% endif %}
                                <td>{{ forloop.counter }}</td>
                                <td>{{ list_law_item.platform_name }}</td>
                                <td>{{ list_law_item.end_date }}</td>
                                <td>{{ list_law_item.document_type }}</td>
                                <td>{{ list_law_item.case_brief }}</td>
                                {% if list_law_item.judge_result2|length|get_digit:"-1" > 40 %}
                                <td>{{ list_law_item.judge_result2|slice:"40" }}...</td>
                                {% else %}
                                <td>{{ list_law_item.judge_result2 }}</td>
                                {% endif %}
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <!-- /.table-responsive -->
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>

        </div>
        <div id="judicialRight" style="float:right; width:45%">
            <div class="Timelineheader">司法案件 Timeline
                <div id="dataYear"></div>
            </div>
            <div class="wrap">
                <div class="timeline2">
                    {% for item in case_info %}
                    <div class="year"><h2 class="hyear" align="left">{{ item.0 }}</h2>
                        {% for case_item in item.1 %}
                        <div class="evt">
                            <div class="in">
                                 <span class="timeLinedate">
                                    <span class="day">{{ case_item.day }}</span>
                                    <span class="month">{{ case_item.month }}</span>
                                 </span>
                                <h2>{{ case_item.brief }}</h2>
                                <p class="data">{{ case_item.title }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    {% endfor %}


                </div>
            </div>
        </div>
    </div>
    <script>$(function () {
            $(window).scroll(function () {
                $('.year').each(function () {
                    var year = $(this).find('h2').first().text();
                    if ($(this).offset().top < $(document).scrollTop() + 100) {
                        $(this).find('.timeLinedate').addClass('activeYear');
                        $('#dataYear').html(year);
                    } else {
                        $(this).find('.timeLinedate').removeClass('activeYear');
                    }
                });
            });
        });
        $(document).ready(function () {
            var year = $('.year').find('h2').first().text();
            $('#dataYear').html(year);
            $('.year').first().find('.timeLinedate').addClass('activeYear');
        });
        var righteight = document.getElementById('judicialRight').scrollHeight;
        var lefteight = document.getElementById('judicialLeft').scrollHeight;
        var judicialDetail = d3.select(".judicialDetail")
        .style("height", function (d) {
                    return Math.max(righteight,lefteight)+"px";
                });
        </script>
</section>

<section id="commerce" class="content-section text-center" style="padding-top:50px">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <h1>工商信息风险分析</h1>
            </div>
        </div>
    </div>
    <div class="row">
        <svg id="fillgauge3" width="20%" height="200"></svg>
    </div>
    <div class="row">
        <div class="col-lg-8" style="float:left; text-align: left; margin-left: auto;margin-right: auto; ">
            <div class="panel panel-info">
                <div class="panel-heading">
                    企业照面信息
                </div>
                <div class="panel-body">
                    <div class="col-lg-12" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">企业名称</commercelabel>
                            <p1 class="help-block" style="width:55%; float:right">{{ company_info.company_name }}</p1>
                        </div>
                    </div>
                    <div class="col-lg-12" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">法人代表</commercelabel>
                            <p1 class="help-block" style="width:55%; float:right">{{ company_info.legal_person }}</p1>
                        </div>
                    </div>
                    <div class="col-lg-6" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">工商注册号</commercelabel>
                            <p1 class="help-block" style="width:45%; float:right">{{ company_info.register_num }}</p1>
                        </div>
                    </div>
                    <div class="col-lg-6" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">统一社会信用代码</commercelabel>
                            <p1 class="help-block" style="width:45%; float:right">{{ company_info.credit_code }}</p1>
                        </div>
                    </div>

                    <div class="col-lg-6" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">组织机构代码</commercelabel>
                            <p1 class="help-block" style="width:45%; float:right">{{ company_info.credit_code }}</p1>
                        </div>
                    </div>
                    <div class="col-lg-6" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">行业门类代码</commercelabel>
                            <p1 class="help-block" style="width:45%; float:right">{{ company_info.economy_code }}</p1>
                        </div>
                    </div>
                    <div class="col-lg-6" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">国民经济行业名称</commercelabel>
                            <p1 class="help-block" style="width:45%; float:right">{{ company_info.trade_type_code }}
                            </p1>
                        </div>
                    </div>
                    <div class="col-lg-6" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">国民经济行业代码</commercelabel>
                            <p1 class="help-block" style="width:45%; float:right">{{ company_info.trade_type_code_old}}
                            </p1>
                        </div>
                    </div>

                    <div class="col-lg-6" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">注册资本(万元)</commercelabel>
                            <p1 class="help-block" style="width:45%; float:right">{{ company_info.register_capital }}
                            </p1>
                        </div>
                    </div>
                    <div class="col-lg-6" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">实收资本(万元)</commercelabel>
                            <p1 class="help-block" style="width:45%; float:right">{{ company_info.paid_in_capital }}
                            </p1>
                        </div>
                    </div>

                    <div class="col-lg-6" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">开业日期</commercelabel>
                            <p1 class="help-block" style="width:45%; float:right">{{ company_info.start_date }}</p1>
                        </div>
                    </div>
                    <div class="col-lg-6" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">经营状态</commercelabel>
                            <p1 class="help-block" style="width:45%; float:right">{{ company_info.business_state }}</p1>
                        </div>
                    </div>
                    <div class="col-lg-6" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">经营起始时间</commercelabel>
                            <p1 class="help-block" style="width:45%; float:right">{{ company_info.business_start_date}}
                            </p1>
                        </div>
                    </div>
                    <div class="col-lg-6" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">经营截止时间</commercelabel>
                            <p1 class="help-block" style="width:45%; float:right">{{ company_info.business_end_date }}
                            </p1>
                        </div>
                    </div>
                    <div class="col-lg-6" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">最后年检年度</commercelabel>
                            <p1 class="help-block" style="width:45%; float:right">{{ company_info.check_day }}</p1>
                        </div>
                    </div>
                    <div class="col-lg-6" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">工商最新变更日期</commercelabel>
                            <p1 class="help-block" style="width:45%; float:right">{{ company_info.check_day }}</p1>
                        </div>
                    </div>
                    <div class="col-lg-6" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">注销日期</commercelabel>
                            <p1 class="help-block" style="width:45%; float:right">{{ company_info.end_date }}</p1>
                        </div>
                    </div>
                    <div class="col-lg-6" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">吊销日期</commercelabel>
                            <p1 class="help-block" style="width:45%; float:right">{{ company_info.revoke_date }}</p1>
                        </div>
                    </div>
                    <div class="col-lg-12" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">企业类型</commercelabel>
                            <p1 class="help-block" style="width:55%; float:right">{{ company_info.company_type }}</p1>
                        </div>
                    </div>
                    <div class="col-lg-12" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">经营业务范围</commercelabel>
                            <p1 class="help-block" style="width:55%; float:right">
                                {{ company_info.business_scope }}
                            </p1>
                        </div>
                    </div>
                    <div class="col-lg-12" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">所属行业</commercelabel>
                            <p1 class="help-block" style="width:55%; float:right">{{ company_info.trade_type }}</p1>
                        </div>
                    </div>
                    <div class="col-lg-12" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">地址</commercelabel>
                            <p1 class="help-block" style="width:55%; float:right">{{ company_info.address }}</p1>
                        </div>
                    </div>
                    <div class="col-lg-12" style="float:left">
                        <div class="form-group">
                            <commercelabel style="padding-top:5px">登记机关</commercelabel>
                            <p1 class="help-block" style="width:55%; float:right">{{ company_info.register_department}}
                            </p1>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8" style="text-align: left; margin-left: auto;margin-right: auto; ">
            <div class="panel panel-default">
                <div class="panel-heading" style="font-size:20px">
                    企业工商信息变更
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>变更日期</th>
                                <th>变更项目</th>
                                <th>变更前内容</th>
                                <th>变更后内容</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for change_item in change_info %}
                            {% if forloop.counter|divisibleby:2 %}
                            <tr class="success">
                                {% else %}
                            <tr class="warning">
                                {% endif %}
                                <td>{{ forloop.counter }}</td>
                                <td>{{ change_item.change_date }}</td>
                                <td>{{ change_item.change_project }}</td>
                                {% if change_item.change_before_content|length|get_digit:"-1" > 80 %}
                                <td>{{ change_item.change_before_content|slice:"80" }}...</td>
                                {% else %}
                                <td>{{ change_item.change_before_content }}</td>
                                {% endif %}
                                {% if change_item.change_after_content|length|get_digit:"-1" > 80 %}
                                <td>{{ change_item.change_after_content|slice:"80" }}...</td>
                                {% else %}
                                <td>{{ change_item.change_after_content }}</td>
                                {% endif %}
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <!-- /.table-responsive -->
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>
    </div>

</section>

<section id="business" class="content-section text-center" style="padding-top:50px">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <h1>经营信息风险分析</h1>
            </div>
        </div>
    </div>
    <div class="row">
        <svg id="fillgauge4" width="20%" height="200"></svg>
    </div>

     <div class="row">
        <div class="col-lg-12" style="text-align: left; margin-left: auto;margin-right: auto; ">
            <div class="panel panel-default">
                <div class="panel-heading" style="font-size:20px">
                    税务非正常户
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>平台名称</th>
                                <th>成交量（万元）</th>
                                <th>平均参考收益率（%）</th>
                                <th>平均借款期限（月）</th>
                                <th>净资金流入（万元）</th>
                                <th>待还余款（万元）</th>
                                <th>满标用时（分）</th>
                                <th>注册资本（万元）</th>
                                <th>运营时间（月）</th>
                                <th>开始日期</th>
                                <th>截止日期</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for wdzj_item in wdzj_info %}
                            {% if forloop.counter|divisibleby:2 %}
                            <tr class="success">
                                {% else %}
                            <tr class="warning">
                                {% endif %}
                                <td>{{ forloop.counter }}</td>
                                <td>{{ wdzj_item.platform_name }}</td>
                                <td>{{ wdzj_item.amount }}</td>
                                <td>{{ wdzj_item.incomerate }}</td>
                                <td>{{ wdzj_item.loanperiod }}</td>
                                <td>{{ wdzj_item.netinflowofthirty }}</td>
                                <td>{{ wdzj_item.staystilloftotal }}</td>
                                <td>{{ wdzj_item.fullloantime }}</td>
                                <td>{{ wdzj_item.regcapital }}</td>
                                <td>{{ wdzj_item.timeoperation }}</td>
                                <td>{{ wdzj_item.startdate }}</td>
                                <td>{{ wdzj_item.enddate }}</td>
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <!-- /.table-responsive -->
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>
    </div>

     <div class="row">
        <div class="col-lg-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    Multiple Axes Line Chart Example
                </div>
                <div class="panel-body">
                    <div class="flot-chart">
                        <div class="flot-chart-content" id="flot-line-chart-multi"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    Moving Line Chart Example
                </div>
                <div class="panel-body">
                    <div class="flot-chart">
                        <div class="flot-chart-content" id="flot-line-chart-moving"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row" style="text-align:center">
        <div id="dynamic" style="width:100%; margin:0 auto"></div>
    </div>

</section>

<section id="tax" class="content-section text-center" style="padding-top:50px">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <h1>税务信息风险分析</h1>
            </div>
        </div>
    </div>
    <div class="row">
        <svg id="fillgauge5" width="20%" height="200"></svg>
    </div>

    <div class="row">
        <div class="col-lg-8" style="text-align: left; margin-left: auto;margin-right: auto; ">
            <div class="panel panel-default">
                <div class="panel-heading" style="font-size:20px">
                    纳税信用等级
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>企业名称</th>
                                <th>评价年份</th>
                                <th>当事人</th>
                                <th>管理机关</th>
                                <th>标题</th>
                                <th>事件结果</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for tax_credit_item in tax_credit_info %}
                            {% if forloop.counter|divisibleby:2 %}
                            <tr class="success">
                                {% else %}
                            <tr class="warning">
                                {% endif %}
                                <td>{{ forloop.counter }}</td>
                                <td>{{ tax_credit_item.platform_name }}</td>
                                <td>{{ tax_credit_item.evaluate_year }}</td>
                                <td>{{ tax_credit_item.company_name }}</td>
                                <td>{{ tax_credit_item.notice_department }}</td>
                                <td>{{ tax_credit_item.notice_title }}</td>
                                <td>{{ tax_credit_item.credit_level }}</td>
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <!-- /.table-responsive -->
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8" style="text-align: left; margin-left: auto;margin-right: auto; ">
            <div class="panel panel-default">
                <div class="panel-heading" style="font-size:20px">
                    欠税公告
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>企业名称</th>
                                <th>欠税日期</th>
                                <th>当事人</th>
                                <th>税种</th>
                                <th>管理机关</th>
                                <th>标题</th>
                                <th>发布时间</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for tax_item in tax_info %}
                            {% if forloop.counter|divisibleby:2 %}
                            <tr class="success">
                                {% else %}
                            <tr class="warning">
                                {% endif %}
                                <td>{{ forloop.counter }}</td>
                                <td>{{ tax_item.platform_name }}</td>
                                <td>{{ tax_item.owe_tax_date }}</td>
                                <td>{{ tax_item.company_name }}</td>
                                <td>{{ tax_item.tax_type }}</td>
                                <td>{{ tax_item.notice_department }}</td>
                                <td>{{ tax_item.notice_title }}</td>
                                <td>{{ tax_item.public_time }}</td>
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <!-- /.table-responsive -->
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8" style="text-align: left; margin-left: auto;margin-right: auto; ">
            <div class="panel panel-default">
                <div class="panel-heading" style="font-size:20px">
                    涉税处罚公示
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>企业名称</th>
                                <th>处罚生效日期</th>
                                <th>当事人</th>
                                <th>事件类型</th>
                                <th>管理机关</th>
                                <th>标题</th>
                                <th>法人代表</th>
                                <th>发布时间</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for tax_penalty_item in tax_penalty_info %}
                            {% if forloop.counter|divisibleby:2 %}
                            <tr class="success">
                                {% else %}
                            <tr class="warning">
                                {% endif %}
                                <td>{{ forloop.counter }}</td>
                                <td>{{ tax_penalty_item.platform_name }}</td>
                                <td>{{ tax_penalty_item.penalty_date }}</td>
                                <td>{{ tax_penalty_item.company_name }}</td>
                                <td>{{ tax_penalty_item.notice_type }}</td>
                                <td>{{ tax_penalty_item.notice_department }}</td>
                                <td>{{ tax_penalty_item.notice_title }}</td>
                                <td>{{ tax_penalty_item.legal_person }}</td>
                                <td>{{ tax_penalty_item.notice_date }}</td>
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <!-- /.table-responsive -->
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8" style="text-align: left; margin-left: auto;margin-right: auto; ">
            <div class="panel panel-default">
                <div class="panel-heading" style="font-size:20px">
                    税务非正常户
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>企业名称</th>
                                <th>认定日期</th>
                                <th>当事人</th>
                                <th>事件名称</th>
                                <th>管理机关</th>
                                <th>标题</th>
                                <th>法人代表</th>
                                <th>发布时间</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for abnormal_tax_item in abnormal_tax_info %}
                            {% if forloop.counter|divisibleby:2 %}
                            <tr class="success">
                                {% else %}
                            <tr class="warning">
                                {% endif %}
                                <td>{{ forloop.counter }}</td>
                                <td>{{ abnormal_tax_item.platform_name }}</td>
                                <td>{{ abnormal_tax_item.notice_date }}</td>
                                <td>{{ abnormal_tax_item.company_name }}</td>
                                <td>{{ abnormal_tax_item.notice_title }}</td>
                                <td>{{ abnormal_tax_item.notice_department }}</td>
                                <td>{{ abnormal_tax_item.title }}</td>
                                <td>{{ abnormal_tax_item.legal_person }}</td>
                                <td>{{ abnormal_tax_item.notice_time }}</td>
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <!-- /.table-responsive -->
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>
    </div>

</section>

<section id="sentiment" class="content-section text-center" style="padding-top:50px">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <h1>舆情信息风险分析</h1>
            </div>
        </div>
    </div>

    <div class="row">
        <svg id="fillgauge6" width="20%" height="200"></svg>
        <div class="bubbleChart" style="float:right;padding-left: 10%"></div>
    </div>

    <div id="wordCloud">
    </div>

    <script src="{{ STATIC_URL }}/static/wordcloud/d3.layout.cloud.js"></script>

    <script>


        $.ajax({method: 'get', url: '/newswords.json'}).done(function (data) {

            var fill = d3.scale.category20();

        wordsList = data.words;

        var layout = d3.layout.cloud()
            .size([1080, 600])
            .words(wordsList.map(function (d) {
                return {text: d[0], size: 20 + d[1]};
            }))
            .padding(5)
            .rotate(function () {
                return ~~(Math.random() * 2) * 90;
            })
            .font("Impact")
            .fontSize(function (d) {
                return d.size;
            })
            .on("end", draw);

        layout.start();

        function draw(words) {
            d3.select("#wordCloud").append("svg")
                .attr("width", layout.size()[0])
                .attr("height", layout.size()[1])
                .append("g")
                .attr("transform", "translate(" + layout.size()[0] / 2 + "," + layout.size()[1] / 2 + ")")
                .selectAll("text")
                .data(words)
                .enter().append("text")
                .style("font-size", function (d) {
                    return d.size + "px";
                })
                .style("font-family", "Impact")
                .style("fill", function (d, i) {
                    return fill(i);
                })
                .attr("text-anchor", "middle")
                .attr("transform", function (d) {
                    return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                })
                .text(function (d) {
                    return d.text;
                });
        }

    }).fail();

    </script>

    <div class="row">
        <div class="col-lg-8" style="text-align: left; margin-left: auto;margin-right: auto; ">
            <div class="panel panel-default">
                <div class="panel-heading" style="font-size:20px">
                    新闻舆论
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>平台名称</th>
                                <th>发布时间</th>
                                <th>关键标签</th>
                                <th>标题</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for news_item in news_info %}
                            {% if forloop.counter|divisibleby:2 %}
                            <tr class="success">
                                {% else %}
                            <tr class="warning">
                                {% endif %}
                                <td>{{ forloop.counter }}</td>
                                <td>{{ news_item.platform_name }}</td>
                                <td>{{ news_item.news_time }}</td>
                                {% if news_item.label|length|get_digit:"-1" > 80 %}
                                <td>{{ news_item.label|slice:"30" }}...</td>
                                {% else %}
                                <td>{{ news_item.label }}</td>
                                {% endif %}

                                {% if news_item.news_title|length|get_digit:"-1" > 80 %}
                                <td>{{ news_item.news_title|slice:"30" }}...</td>
                                {% else %}
                                <td>{{ news_item.news_title }}</td>
                                {% endif %}

                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <!-- /.table-responsive -->
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>
    </div>

    <!--<a href="#out_line" class="btn btn-circle js-scroll-trigger" style="margin-top:210px; color:gray">-->
    <!--<i class="fa fa-angle-double-down animated"></i>-->
    <!--</a>-->
</section>

<!-- Download Section -->
<section id="out_line" class="download-section1 content-section text-center" style="padding-top:50px">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <h1>违规信息风险分析</h1>
            </div>
        </div>
    </div>
    <div class="row">
        <svg id="fillgauge7" width="20%" height="200"></svg>
    </div>

    <div class="row">
        <div class="col-lg-8" style="text-align: left; margin-left: auto;margin-right: auto; ">
            <div class="panel panel-default">
                <div class="panel-heading" style="font-size:20px">
                    银行存管信息
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>主体企业</th>
                                <th>链接</th>
                                <th>是否包含银行存管</th>
                                <th>是否包含存管</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for bank_depository_item in bank_depository_info %}
                            {% if forloop.counter|divisibleby:2 %}
                            <tr class="success">
                                {% else %}
                            <tr class="warning">
                                {% endif %}
                                <td>{{ forloop.counter }}</td>
                                <td>{{ bank_depository_item.company_name }}</td>
                                <td>{{ bank_depository_item.website_url }}</td>
                                <td>{{ bank_depository_item.is_bank_depository }}</td>
                                <td>{{ bank_depository_item.is_depository }}</td>
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <!-- /.table-responsive -->
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8" style="text-align: left; margin-left: auto;margin-right: auto; ">
            <div class="panel panel-default">
                <div class="panel-heading" style="font-size:20px">
                    ICP信息
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>单位名称</th>
                                <th>主办单位性质</th>
                                <th>网站备案</th>
                                <th>网站名称</th>
                                <th>网站首页网址</th>
                                <th>审核时间</th>
                                <th>是否限制接入</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for icp_item in icp_info %}
                            {% if forloop.counter|divisibleby:2 %}
                            <tr class="success">
                                {% else %}
                            <tr class="warning">
                                {% endif %}
                                <td>{{ forloop.counter }}</td>
                                <td>{{ icp_item.company_name }}</td>
                                <td>{{ icp_item.company_type }}</td>
                                <td>{{ icp_item.licence_num }}</td>
                                <td>{{ icp_item.website_name }}</td>
                                <td>{{ icp_item.website_url }}</td>
                                <td>{{ icp_item.examine_date }}</td>
                                <td>{{ icp_item.is_restriction }}</td>
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <!-- /.table-responsive -->
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>
    </div>


</section>

<section id="employee" class="content-section text-center" style="padding-top:50px">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <h1>招聘信息风险分析</h1>
            </div>
        </div>
    </div>

    <div class="row">
        <svg id="fillgauge8" width="20%" height="200"></svg>
        <div id="employee_radar"></div>
    </div>

    <div class="row">
        <div class="col-lg-6">
            <div class="panel panel-default">
                <div class="panel-heading" style="color:black">
                    Area Chart Example
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <div id="morris-area-chart"></div>
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>

        <div class="col-lg-6">
            <div class="panel panel-default">
                <div class="panel-heading" style="color:black">
                    Donut Chart Example
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <div id="morris-donut-chart"></div>
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>
    </div>

    <script>



        $.ajax({method:'get',url:'/salarylevel.json'}).done(function (data){
            salary = data.salary_data;

            var width = 960,
            height = 800,
            radius = Math.min(width, height) / 1.9,
            spacing = .08;

        var color = d3.scale.linear()
            .range(["hsl(-180,50%,50%)", "hsl(180,50%,50%)"])
            .interpolate(interpolateHsl);

        var arc = d3.svg.arc()
            .startAngle(0.0)
            .endAngle(function (d) {
                return (d.value * 2 * Math.PI);
            })
            .innerRadius(function (d) {
                return d.index * radius;
            })
            .outerRadius(function (d) {
                return (d.index + spacing) * radius;
            });
        var formatter = d3.format(".2%");
        var svg = d3.select("#employee_radar").append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

        var gradient = svg
            .selectAll("linearGradient").data(fields).enter()
            .append("linearGradient")
            .attr("y1", "0%")
            .attr("y2", "0%")
            .attr("x1", "0%")
            .attr("x2", "100%")
            .attr("gradientUnits", "objectBoundingBox")
            .attr('id', function (d) {
                return "gradient-" + d.index * 10
            })
        gradient.append("stop")
            .attr("offset", "0%")
            .attr("stop-opacity", "1")
            .attr("stop-color", function (d) {
                return color(d.index);
            });
        gradient.append("stop")
            .attr("offset", function (d) {
                return 30 + "%"
            })
            .attr("stop-opacity", ".5")
            .attr("stop-color", function (d) {
                return color(d.index);
            });
        gradient.append("stop")
            .attr("offset", function (d) {
                return 80 + "%"
            })
            .attr("stop-opacity", "0.7")
            .attr("stop-color", function (d) {
                return color(d.index);
            });


        var field = svg.selectAll("g")
            .data(fields)
            .enter().append("g");

        field.append("path");
        field.append("rect");
        field.append("text");

        d3.transition().duration(0).each(tick);
        d3.select(self.frameElement).style("height", height + "px");



        function tick() {
             var salaryArray = ['0-5k','5k-10k','10k-15k','15k-20k','>20k'];

            field = field
                .each(function (d) {
                    this._value = d.value;
                })
                .data(fields)
                .each(function (d) {
                    d.previousValue = this._value;
                });
            field.select("path")
                .transition()
                .ease("linear")
                .attrTween("d", arcTween)
                .style("opacity", function (d) {
                    return .7;
                })
                .style("fill", function (d) {
                    return color(d.index);
                });
            field.select("text")
                .attr("x", function (d) {
                    return -( ((fields().length / 10) + spacing) * radius) - 50;
                })
                .attr("y", function (d) {
                    return -(((d.index + spacing) * radius)) + 20;
                })
                .text(function (d,i) {
                    return salaryArray[i]+' : '+formatter(d.value);
                })
                .style("font-size", "15px")
                .transition()
                .ease("linear")
                .attr("transform", function (d) {
                    return "rotate(0)"
                        + "translate(0,0)"
                        + "rotate(0)"
                });
            field.select("rect")
                .attr("x", function (d) {
                    return -( ((fields().length / 10) + spacing) * radius) - 100;
                })
                .attr("y", function (d) {
                    return -(((d.index + spacing) * radius));
                })
                .attr("height", function (d) {
                    return ((d.index + spacing) * radius) - (d.index * radius)
                })
                .attr("width", function (d) {
                    return ((fields().length / 10) + spacing) * radius + 90;
                })
                .text(function (d) {
                    return formatter(d.value);
                })
                .attr("fill", function (d) {
                    return "url(#gradient-" + d.index * 10 + ")"
                })
                .transition()
                .attr("transform", function (d) {
                    return "rotate(0)"
                        + "translate(0,0)"
                        + "rotate(0)"
                });

            setTimeout(tick, 3000);
        }

        function arcTween(d) {
            var i = d3.interpolateNumber(d.previousValue, d.value);
            return function (t) {
                d.value = i(t);
                return arc(d);
            };
        }
            function fields() {
            var temp = 1.0;
            salary[3] = Math.random()*temp;
            temp = temp - salary[3];
            salary[2] = Math.random()*temp;
            temp = temp - salary[2];
            salary[1] = Math.random()*temp;
            temp = temp - salary[1];
            salary[4] = Math.random()*temp;
            temp = temp - salary[4];
            salary[0] = Math.random()*temp;
            temp = temp - salary[0];
            return [
                {index: .1, value: salary[0]},
                {index: .2, value: salary[1]},
                {index: .3, value: salary[2]},
                {index: .4, value: salary[3]},
                {index: .5, value: salary[4]}
            ];
        }

        // Avoid shortest-path interpolation.
        function interpolateHsl(a, b) {
            var i = d3.interpolateString(a, b);
            return function (t) {
                return d3.hsl(i(t));
            };
        }

    }).fail();


    </script>

</section>


<!-- Footer -->
<footer>
    <div class="container text-center">
        <p>Copyright &copy; 166.111.83.80 2017</p>
    </div>
</footer>

<!-- Bootstrap core JavaScript -->
<script src="{{ STATIC_URL }}/static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Plugin JavaScript -->
<script src="{{ STATIC_URL }}/static/vendor/jquery-easing/jquery.easing.min.js"></script>

<!-- Custom scripts for this template -->
<script src="{{ STATIC_URL }}/static/js/grayscale.min.js"></script>

<!-- Morris Charts JavaScript -->
<script src="{{ STATIC_URL }}/static/vendor/raphael/raphael.min.js"></script>
<script src="{{ STATIC_URL }}/static/vendor/morrisjs/morris.min.js"></script>
<script src="{{ STATIC_URL }}/static/data/morris-data.js"></script>

<!-- Flot Charts JavaScript -->
<script src="{{ STATIC_URL }}/static/vendor/flot/excanvas.min.js"></script>
<script src="{{ STATIC_URL }}/static/vendor/flot/jquery.flot.js"></script>
<script src="{{ STATIC_URL }}/static/vendor/flot/jquery.flot.pie.js"></script>
<script src="{{ STATIC_URL }}/static/vendor/flot/jquery.flot.resize.js"></script>
<script src="{{ STATIC_URL }}/static/vendor/flot/jquery.flot.time.js"></script>
<script src="{{ STATIC_URL }}/static/vendor/flot-tooltip/jquery.flot.tooltip.min.js"></script>
<script src="{{ STATIC_URL }}/static/data/flot-data.js"></script>

<script language="JavaScript">
    var config1 = liquidFillGaugeDefaultSettings();
    config1.circleColor = "#F00000";
    config1.textColor = "#F00222";
    config1.waveTextColor = "#F00333";
    config1.waveColor = "#F04444";
    config1.circleThickness = 0.05;
    config1.circleFillGap = 0.01;
    config1.textVertPosition = 0.52;
    config1.waveAnimateTime = 5000;
    config1.waveHeight = 0.1;
    config1.waveCount = 1;
    config1.textSize = 2.1;
    config1.displayPercent = false;
    var gauge1 = loadLiquidFillGauge("fillgauge1", {{ total_risk_score }}, config1);
    var gauge1 = loadLiquidFillGauge("fillgauge2", {{ law_risk_score }}, config1);
    var gauge1 = loadLiquidFillGauge("fillgauge3", {{ admin_risk_score }}, config1);
    var gauge1 = loadLiquidFillGauge("fillgauge4", {{ business_risk_score }}, config1);
    var gauge1 = loadLiquidFillGauge("fillgauge5", {{ tax_risk_score }}, config1);
    var gauge1 = loadLiquidFillGauge("fillgauge6", {{ news_risk_score }}, config1);
    var gauge1 = loadLiquidFillGauge("fillgauge7", {{ outline_risk_score }}, config1);
    var gauge1 = loadLiquidFillGauge("fillgauge8", {{ employ_risk_score }}, config1);
</script>


<script>

    $.ajax({method:'get',url:'/judgementprovince.json'}).done(function (data){

        provinceCount = data.province_count;


        function tooltipHtml(n, d) {    /* function to create html content string in tooltip div. */
        return "<h4 style='color:white'>" + n + "</h4><table>" +
            "<tr><td>Average</td><td>" + (d.avg) + "</td></tr>" +
            "</table>";
    }

    var sampleData = {};
    var nums = provinceCount;
    ['JXI', 'LIA', 'TIB', 'NMG', 'SHH', 'CHQ', 'XIN', 'SHD', 'HEN', 'GUD', 'GUI', 'BEJ', 'MAC', 'TAJ', 'HLJ', 'HEB', 'ZHJ', 'ANH', 'GXI', 'HAI', 'JIL', 'SHX', 'HUN', 'YUN', 'FUJ', 'HUB', 'SHA', 'HKG', 'QIH', 'GAN', 'JSU', 'SCH', 'NXA', 'TAI']
        .forEach(function (d,i) {
//            alert(nums[i]);
            var low = nums[i],
                mid = nums[i],
                high = nums[i];
            var value = nums[i];
            if (value>20){
                value = 20
            }
            sampleData[d] = {
                avg: Math.round((low + mid + high) / 3), color: d3.interpolate("#ffffcc", "#700000")(value / 20)
            };
        });

    uStates.draw("#statesvg", sampleData, tooltipHtml);

    }).fail()



</script>

<script>

    var m = [20, 20, 30, 20],
        w = 1000 - m[1] - m[3],
        h = 550 - m[0] - m[2];

    var x,
        y,
        duration = 1500,
        delay = 600;

    var color = d3.scale.category10();

    var svg = d3.select("#dynamic").append("svg")
        .attr("width", w + m[1] + m[3])
        .attr("height", h + m[0] + m[2])
//        .style("float", "left")
        .append("g")
        .attr("transform", "translate(" + m[3] + "," + m[0] + ")");

    var stocks,
        symbols;

    // A line generator, for the dark stroke.
    var line = d3.svg.line()
        .interpolate("basis")
        .x(function (d) {
            return x(d.date);
        })
        .y(function (d) {
            return y(d.price);
        });

    // A line generator, for the dark stroke.
    var axis = d3.svg.line()
        .interpolate("basis")
        .x(function (d) {
            return x(d.date);
        })
        .y(h);

    // A area generator, for the dark stroke.
    var area = d3.svg.area()
        .interpolate("basis")
        .x(function (d) {
            return x(d.date);
        })
        .y1(function (d) {
            return y(d.price);
        });

    d3.csv("{{ STATIC_URL }}/static/data/stocks.csv", function (data) {

        {#console.log(data);#}

        var parse = d3.time.format("%b %Y").parse;

        // Nest stock values by symbol.
        symbols = d3.nest()
            .key(function (d) {
                return d.symbol;
            })
            .entries(stocks = data);

        // Parse dates and numbers. We assume values are sorted by date.
        // Also compute the maximum price per symbol, needed for the y-domain.
        symbols.forEach(function (s) {
            s.values.forEach(function (d) {
                d.date = parse(d.date);
                d.price = +d.price;
            });
            s.maxPrice = d3.max(s.values, function (d) {
                return d.price;
            });
            s.sumPrice = d3.sum(s.values, function (d) {
                return d.price;
            });
        });

        // Sort by maximum price, descending.
        symbols.sort(function (a, b) {
            return b.maxPrice - a.maxPrice;
        });

        var g = svg.selectAll("g")
            .data(symbols)
            .enter().append("g")
            .attr("class", "symbol");

        setTimeout(lines, duration);
    });

    function lines() {
        x = d3.time.scale().range([0, w - 60]);
        y = d3.scale.linear().range([h / 4 - 20, 0]);

        // Compute the minimum and maximum date across symbols.
        x.domain([
            d3.min(symbols, function (d) {
                return d.values[0].date;
            }),
            d3.max(symbols, function (d) {
                return d.values[d.values.length - 1].date;
            })
        ]);

        var g = svg.selectAll(".symbol")
            .attr("transform", function (d, i) {
                return "translate(0," + (i * h / 4 + 10) + ")";
            });

        g.each(function (d) {
            var e = d3.select(this);

            e.append("path")
                .attr("class", "line");

            e.append("circle")
                .attr("r", 5)
                .style("fill", function (d) {
                    return color(d.key);
                })
                .style("stroke", "#000")
                .style("stroke-width", "2px");

            e.append("text")
                .attr("x", 12)
                .attr("dy", ".31em")
                .text(d.key);
        });

        function draw(k) {
            g.each(function (d) {
                var e = d3.select(this);
                y.domain([0, d.maxPrice]);

                e.select("path")
                    .attr("d", function (d) {
                        return line(d.values.slice(0, k + 1));
                    });

                e.selectAll("circle, text")
                    .data(function (d) {
                        return [d.values[k], d.values[k]];
                    })
                    .attr("transform", function (d) {
                        return "translate(" + x(d.date) + "," + y(d.price) + ")";
                    });
            });
        }

        var k = 1, n = symbols[0].values.length;
        d3.timer(function () {
            draw(k);
            if ((k += 2) >= n - 1) {
                draw(n - 1);
                setTimeout(horizons, 500);
                return true;
            }
        });
    }

    function horizons() {
        svg.insert("defs", ".symbol")
            .append("clipPath")
            .attr("id", "clip")
            .append("rect")
            .attr("width", w)
            .attr("height", h / 4 - 20);

        var color = d3.scale.ordinal()
            .range(["#c6dbef", "#9ecae1", "#6baed6"]);

        var g = svg.selectAll(".symbol")
            .attr("clip-path", "url(#clip)");

        area
            .y0(h / 4 - 20);

        g.select("circle").transition()
            .duration(duration)
            .attr("transform", function (d) {
                return "translate(" + (w - 60) + "," + (-h / 4) + ")";
            })
            .remove();

        g.select("text").transition()
            .duration(duration)
            .attr("transform", function (d) {
                return "translate(" + (w - 60) + "," + (h / 4 - 20) + ")";
            })
            .attr("dy", "0em");

        g.each(function (d) {
            y.domain([0, d.maxPrice]);

            d3.select(this).selectAll(".area")
                .data(d3.range(3))
                .enter().insert("path", ".line")
                .attr("class", "area")
                .attr("transform", function (d) {
                    return "translate(0," + (d * (h / 4 - 20)) + ")";
                })
                .attr("d", area(d.values))
                .style("fill", function (d, i) {
                    return color(i);
                })
                .style("fill-opacity", 1e-6);

            y.domain([0, d.maxPrice / 3]);

            d3.select(this).selectAll(".line").transition()
                .duration(duration)
                .attr("d", line(d.values))
                .style("stroke-opacity", 1e-6);

            d3.select(this).selectAll(".area").transition()
                .duration(duration)
                .style("fill-opacity", 1)
                .attr("d", area(d.values))
                .each("end", function () {
                    d3.select(this).style("fill-opacity", null);
                });
        });

        setTimeout(areas, duration + delay);
    }

    function areas() {
        var g = svg.selectAll(".symbol");

        axis
            .y(h / 4 - 21);

        g.select(".line")
            .attr("d", function (d) {
                return axis(d.values);
            });

        g.each(function (d) {
            y.domain([0, d.maxPrice]);

            d3.select(this).select(".line").transition()
                .duration(duration)
                .style("stroke-opacity", 1)
                .each("end", function () {
                    d3.select(this).style("stroke-opacity", null);
                });

            d3.select(this).selectAll(".area")
                .filter(function (d, i) {
                    return i;
                })
                .transition()
                .duration(duration)
                .style("fill-opacity", 1e-6)
                .attr("d", area(d.values))
                .remove();

            d3.select(this).selectAll(".area")
                .filter(function (d, i) {
                    return !i;
                })
                .transition()
                .duration(duration)
                .style("fill", color(d.key))
                .attr("d", area(d.values));
        });

        svg.select("defs").transition()
            .duration(duration)
            .remove();

        g.transition()
            .duration(duration)
            .each("end", function () {
                d3.select(this).attr("clip-path", null);
            });

        setTimeout(stackedArea, duration + delay);
    }

    function stackedArea() {
        var stack = d3.layout.stack()
            .values(function (d) {
                return d.values;
            })
            .x(function (d) {
                return d.date;
            })
            .y(function (d) {
                return d.price;
            })
            .out(function (d, y0, y) {
                d.price0 = y0;
            })
            .order("reverse");

        stack(symbols);

        y
            .domain([0, d3.max(symbols[0].values.map(function (d) {
                return d.price + d.price0;
            }))])
            .range([h, 0]);

        line
            .y(function (d) {
                return y(d.price0);
            });

        area
            .y0(function (d) {
                return y(d.price0);
            })
            .y1(function (d) {
                return y(d.price0 + d.price);
            });

        var t = svg.selectAll(".symbol").transition()
            .duration(duration)
            .attr("transform", "translate(0,0)")
            .each("end", function () {
                d3.select(this).attr("transform", null);
            });

        t.select("path.area")
            .attr("d", function (d) {
                return area(d.values);
            });

        t.select("path.line")
            .style("stroke-opacity", function (d, i) {
                return i < 3 ? 1e-6 : 1;
            })
            .attr("d", function (d) {
                return line(d.values);
            });

        t.select("text")
            .attr("transform", function (d) {
                d = d.values[d.values.length - 1];
                return "translate(" + (w - 60) + "," + y(d.price / 2 + d.price0) + ")";
            });

        setTimeout(streamgraph, duration + delay);
    }

    function streamgraph() {
        var stack = d3.layout.stack()
            .values(function (d) {
                return d.values;
            })
            .x(function (d) {
                return d.date;
            })
            .y(function (d) {
                return d.price;
            })
            .out(function (d, y0, y) {
                d.price0 = y0;
            })
            .order("reverse")
            .offset("wiggle");

        stack(symbols);

        line
            .y(function (d) {
                return y(d.price0);
            });

        var t = svg.selectAll(".symbol").transition()
            .duration(duration);

        t.select("path.area")
            .attr("d", function (d) {
                return area(d.values);
            });

        t.select("path.line")
            .style("stroke-opacity", 1e-6)
            .attr("d", function (d) {
                return line(d.values);
            });

        t.select("text")
            .attr("transform", function (d) {
                d = d.values[d.values.length - 1];
                return "translate(" + (w - 60) + "," + y(d.price / 2 + d.price0) + ")";
            });

        setTimeout(overlappingArea, duration + delay);
    }

    function overlappingArea() {
        var g = svg.selectAll(".symbol");

        line
            .y(function (d) {
                return y(d.price0 + d.price);
            });

        g.select(".line")
            .attr("d", function (d) {
                return line(d.values);
            });

        y
            .domain([0, d3.max(symbols.map(function (d) {
                return d.maxPrice;
            }))])
            .range([h, 0]);

        area
            .y0(h)
            .y1(function (d) {
                return y(d.price);
            });

        line
            .y(function (d) {
                return y(d.price);
            });

        var t = g.transition()
            .duration(duration);

        t.select(".line")
            .style("stroke-opacity", 1)
            .attr("d", function (d) {
                return line(d.values);
            });

        t.select(".area")
            .style("fill-opacity", .5)
            .attr("d", function (d) {
                return area(d.values);
            });

        t.select("text")
            .attr("dy", ".31em")
            .attr("transform", function (d) {
                d = d.values[d.values.length - 1];
                return "translate(" + (w - 60) + "," + y(d.price) + ")";
            });

        svg.append("line")
            .attr("class", "line")
            .attr("x1", 0)
            .attr("x2", w - 60)
            .attr("y1", h)
            .attr("y2", h)
            .style("stroke-opacity", 1e-6)
            .transition()
            .duration(duration)
            .style("stroke-opacity", 1);

        setTimeout(groupedBar, duration + delay);
    }

    function groupedBar() {
        x = d3.scale.ordinal()
            .domain(symbols[0].values.map(function (d) {
                return d.date;
            }))
            .rangeBands([0, w - 60], .1);

        var x1 = d3.scale.ordinal()
            .domain(symbols.map(function (d) {
                return d.key;
            }))
            .rangeBands([0, x.rangeBand()]);

        var g = svg.selectAll(".symbol");

        var t = g.transition()
            .duration(duration);

        t.select(".line")
            .style("stroke-opacity", 1e-6)
            .remove();

        t.select(".area")
            .style("fill-opacity", 1e-6)
            .remove();

        g.each(function (p, j) {
            d3.select(this).selectAll("rect")
                .data(function (d) {
                    return d.values;
                })
                .enter().append("rect")
                .attr("x", function (d) {
                    return x(d.date) + x1(p.key);
                })
                .attr("y", function (d) {
                    return y(d.price);
                })
                .attr("width", x1.rangeBand())
                .attr("height", function (d) {
                    return h - y(d.price);
                })
                .style("fill", color(p.key))
                .style("fill-opacity", 1e-6)
                .transition()
                .duration(duration)
                .style("fill-opacity", 1);
        });

        setTimeout(stackedBar, duration + delay);
    }

    function stackedBar() {
        x.rangeRoundBands([0, w - 60], .1);

        var stack = d3.layout.stack()
            .values(function (d) {
                return d.values;
            })
            .x(function (d) {
                return d.date;
            })
            .y(function (d) {
                return d.price;
            })
            .out(function (d, y0, y) {
                d.price0 = y0;
            })
            .order("reverse");

        var g = svg.selectAll(".symbol");

        stack(symbols);

        y
            .domain([0, d3.max(symbols[0].values.map(function (d) {
                return d.price + d.price0;
            }))])
            .range([h, 0]);

        var t = g.transition()
            .duration(duration / 2);

        t.select("text")
            .delay(symbols[0].values.length * 10)
            .attr("transform", function (d) {
                d = d.values[d.values.length - 1];
                return "translate(" + (w - 60) + "," + y(d.price / 2 + d.price0) + ")";
            });

        t.selectAll("rect")
            .delay(function (d, i) {
                return i * 10;
            })
            .attr("y", function (d) {
                return y(d.price0 + d.price);
            })
            .attr("height", function (d) {
                return h - y(d.price);
            })
            .each("end", function () {
                d3.select(this)
                    .style("stroke", "#fff")
                    .style("stroke-opacity", 1e-6)
                    .transition()
                    .duration(duration / 2)
                    .attr("x", function (d) {
                        return x(d.date);
                    })
                    .attr("width", x.rangeBand())
                    .style("stroke-opacity", 1);
            });

        setTimeout(transposeBar, duration + symbols[0].values.length * 10 + delay);
    }

    function transposeBar() {
        x
            .domain(symbols.map(function (d) {
                return d.key;
            }))
            .rangeRoundBands([0, w], .2);

        y
            .domain([0, d3.max(symbols.map(function (d) {
                return d3.sum(d.values.map(function (d) {
                    return d.price;
                }));
            }))]);

        var stack = d3.layout.stack()
            .x(function (d, i) {
                return i;
            })
            .y(function (d) {
                return d.price;
            })
            .out(function (d, y0, y) {
                d.price0 = y0;
            });

        stack(d3.zip.apply(null, symbols.map(function (d) {
            return d.values;
        }))); // transpose!

        var g = svg.selectAll(".symbol");

        var t = g.transition()
            .duration(duration / 2);

        t.selectAll("rect")
            .delay(function (d, i) {
                return i * 10;
            })
            .attr("y", function (d) {
                return y(d.price0 + d.price) - 1;
            })
            .attr("height", function (d) {
                return h - y(d.price) + 1;
            })
            .attr("x", function (d) {
                return x(d.symbol);
            })
            .attr("width", x.rangeBand())
            .style("stroke-opacity", 1e-6);

        t.select("text")
            .attr("x", 0)
            .attr("transform", function (d) {
                return "translate(" + (x(d.key) + x.rangeBand() / 2) + "," + h + ")";
            })
            .attr("dy", "1.31em")
            .each("end", function () {
                d3.select(this).attr("x", null).attr("text-anchor", "middle");
            });

        svg.select("line").transition()
            .duration(duration)
            .attr("x2", w);

        setTimeout(donut, duration / 2 + symbols[0].values.length * 10 + delay);
    }

    function donut() {
        var g = svg.selectAll(".symbol");

        g.selectAll("rect").remove();

        var pie = d3.layout.pie()
            .value(function (d) {
                return d.sumPrice;
            });

        var arc = d3.svg.arc();

        g.append("path")
            .style("fill", function (d) {
                return color(d.key);
            })
            .data(function () {
                return pie(symbols);
            })
            .transition()
            .duration(duration)
            .tween("arc", arcTween);

        g.select("text").transition()
            .duration(duration)
            .attr("dy", ".31em");

        svg.select("line").transition()
            .duration(duration)
            .attr("y1", 2 * h)
            .attr("y2", 2 * h)
            .remove();

        function arcTween(d) {
            var path = d3.select(this),
                text = d3.select(this.parentNode.appendChild(this.previousSibling)),
                x0 = x(d.data.key),
                y0 = h - y(d.data.sumPrice);

            return function (t) {
                var r = h / 2 / Math.min(1, t + 1e-3),
                    a = Math.cos(t * Math.PI / 2),
                    xx = (-r + (a) * (x0 + x.rangeBand()) + (1 - a) * (w + h) / 2),
                    yy = ((a) * h + (1 - a) * h / 2),
                    f = {
                        innerRadius: r - x.rangeBand() / (2 - a),
                        outerRadius: r,
                        startAngle: a * (Math.PI / 2 - y0 / r) + (1 - a) * d.startAngle,
                        endAngle: a * (Math.PI / 2) + (1 - a) * d.endAngle
                    };

                path.attr("transform", "translate(" + xx + "," + yy + ")");
                path.attr("d", arc(f));
                text.attr("transform", "translate(" + arc.centroid(f) + ")translate(" + xx + "," + yy + ")rotate(" + ((f.startAngle + f.endAngle) / 2 + 3 * Math.PI / 2) * 180 / Math.PI + ")");
            };
        }

        setTimeout(donutExplode, duration + delay);
    }

    function donutExplode() {
        var r0a = h / 2 - x.rangeBand() / 2,
            r1a = h / 2,
            r0b = 2 * h - x.rangeBand() / 2,
            r1b = 2 * h,
            arc = d3.svg.arc();

        svg.selectAll(".symbol path")
            .each(transitionExplode);

        function transitionExplode(d, i) {
            d.innerRadius = r0a;
            d.outerRadius = r1a;
            d3.select(this).transition()
                .duration(duration / 2)
                .tween("arc", tweenArc({
                    innerRadius: r0b,
                    outerRadius: r1b
                }));
        }

        function tweenArc(b) {
            return function (a) {
                var path = d3.select(this),
                    text = d3.select(this.nextSibling),
                    i = d3.interpolate(a, b);
                for (var key in b) a[key] = b[key]; // update data
                return function (t) {
                    var a = i(t);
                    path.attr("d", arc(a));
                    text.attr("transform", "translate(" + arc.centroid(a) + ")translate(" + w / 2 + "," + h / 2 + ")rotate(" + ((a.startAngle + a.endAngle) / 2 + 3 * Math.PI / 2) * 180 / Math.PI + ")");
                };
            }
        }

        setTimeout(function () {
            svg.selectAll("*").remove();
            svg.selectAll("g").data(symbols).enter().append("g").attr("class", "symbol");
            lines();
        }, duration);
    }

</script>

</body>
